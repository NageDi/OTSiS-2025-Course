import nbformat as nbf
import os

nb = nbf.v4.new_notebook()

# ===== 1. –ó–ê–ì–û–õ–û–í–û–ö =====
md1 = r"""# üéöÔ∏è –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ ‚Ññ4: –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–∏—Ñ—Ä–æ–≤—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
**–ö—É—Ä—Å:** –û—Å–Ω–æ–≤—ã —Ç–µ–æ—Ä–∏–∏ —Å–∏–≥–Ω–∞–ª–æ–≤ –∏ —Å–∏—Å—Ç–µ–º (–û–¢–°–∏–°)  
**–¶–µ–ª—å:** –ù–∞—É—á–∏—Ç—å—Å—è –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å FIR –∏ IIR —Ñ–∏–ª—å—Ç—Ä—ã –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ —Å–∏–≥–Ω–∞–ª–æ–≤.

## üéØ –¢–∏–ø—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤
1. **Low-Pass (–§–ù–ß):** –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç –Ω–∏–∑–∫–∏–µ —á–∞—Å—Ç–æ—Ç—ã, –¥–∞–≤–∏—Ç –≤—ã—Å–æ–∫–∏–µ.
2. **High-Pass (–§–í–ß):** –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç –≤—ã—Å–æ–∫–∏–µ, –¥–∞–≤–∏—Ç –Ω–∏–∑–∫–∏–µ.
3. **Band-Pass (–ü–§):** –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç –ø–æ–ª–æ—Å—É —á–∞—Å—Ç–æ—Ç.
4. **Band-Stop (–†–§):** –í—ã—Ä–µ–∑–∞–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —á–∞—Å—Ç–æ—Ç—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, 50 –ì—Ü)."""

# ===== 2. –ò–ú–ü–û–†–¢–´ =====
code_imports = """import numpy as np
import matplotlib.pyplot as plt
from scipy import signal

plt.style.use('seaborn-v0_8-whitegrid')
plt.rcParams['figure.figsize'] = (12, 6)
print('‚úÖ –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ –≥–æ—Ç–æ–≤—ã!')"""

# ===== 3. –¢–ï–û–†–ò–Ø: FIR vs IIR =====
md2 = r"""## 1. FIR vs IIR –§–∏–ª—å—Ç—Ä—ã

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | FIR (Finite Impulse Response) | IIR (Infinite Impulse Response) |
|---|---|---|
| **–£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å** | –í—Å–µ–≥–¥–∞ —É—Å—Ç–æ–π—á–∏–≤ | –ú–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—É—Å—Ç–æ–π—á–∏–≤ |
| **–§–∞–∑–∞** | –õ–∏–Ω–µ–π–Ω–∞—è (–Ω–µ –∏—Å–∫–∞–∂–∞–µ—Ç —Ñ–æ—Ä–º—É) | –ù–µ–ª–∏–Ω–µ–π–Ω–∞—è |
| **–ü–æ—Ä—è–¥–æ–∫** | –í—ã—Å–æ–∫–∏–π (—Ç—Ä–µ–±—É–µ—Ç –º–Ω–æ–≥–æ –≤—ã—á–∏—Å–ª–µ–Ω–∏–π) | –ù–∏–∑–∫–∏–π (—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–µ–Ω) |
| **–ü—Ä–∏–º–µ—Ä** | `signal.firwin` | Butterworth, Chebyshev |"""

# ===== 4. –ü–†–û–ï–ö–¢–ò–†–û–í–ê–ù–ò–ï IIR (Butterworth) =====
code_iir = """# –ó–∞–¥–∞—á–∞: –£–±—Ä–∞—Ç—å –≤—ã—Å–æ–∫–æ—á–∞—Å—Ç–æ—Ç–Ω—ã–π —à—É–º –∏–∑ –≠–ö–ì-–ø–æ–¥–æ–±–Ω–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞
fs = 1000
t = np.arange(0, 2, 1/fs)

# –ò–º–∏—Ç–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–∞: –º–µ–¥–ª–µ–Ω–Ω–∞—è –≤–æ–ª–Ω–∞ (2 –ì—Ü) + —à—É–º (50 –ì—Ü)
x = np.sin(2*np.pi*2*t) + 0.5*np.sin(2*np.pi*50*t)

# –ü—Ä–æ–µ–∫—Ç–∏—Ä—É–µ–º —Ñ–∏–ª—å—Ç—Ä –ë–∞—Ç—Ç–µ—Ä–≤–æ—Ä—Ç–∞ (Low-Pass)
# –ß–∞—Å—Ç–æ—Ç–∞ —Å—Ä–µ–∑–∞ 10 –ì—Ü (–≤—Å–µ —á—Ç–æ –≤—ã—à–µ - –¥–∞–≤–∏–º)
cutoff = 10  # –ì—Ü
order = 4    # –ü–æ—Ä—è–¥–æ–∫ —Ñ–∏–ª—å—Ç—Ä–∞ (–∫—Ä—É—Ç–∏–∑–Ω–∞ —Å–ø–∞–¥–∞)

# –°–æ–∑–¥–∞–µ–º –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã —Ñ–∏–ª—å—Ç—Ä–∞ (b, a)
b, a = signal.butter(order, cutoff, btype='low', fs=fs)

# –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä (filtfilt - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –±–µ–∑ —Å–¥–≤–∏–≥–∞ —Ñ–∞–∑—ã)
y = signal.filtfilt(b, a, x)

# –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
fig, (ax1, ax2) = plt.subplots(2, 1, sharex=True)

ax1.plot(t[:200], x[:200], 'r', alpha=0.5, label='–°–∏–≥–Ω–∞–ª + –®—É–º (50 –ì—Ü)')
ax1.plot(t[:200], y[:200], 'b', linewidth=2, label='–û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–π (Butterworth)')
ax1.set_title('–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏')
ax1.legend()
ax1.grid(True)

# –ß–∞—Å—Ç–æ—Ç–Ω–∞—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞ (–ê–ß–•)
w, h = signal.freqz(b, a, fs=fs)
ax2.plot(w, 20 * np.log10(abs(h)), 'g')
ax2.set_title('–ê–ß–• —Ñ–∏–ª—å—Ç—Ä–∞ (Bode Plot)')
ax2.set_xlabel('–ß–∞—Å—Ç–æ—Ç–∞, –ì—Ü')
ax2.set_ylabel('–ê–º–ø–ª–∏—Ç—É–¥–∞, –¥–ë')
ax2.set_xlim([0, 100])
ax2.set_ylim([-60, 5])
ax2.axvline(cutoff, color='k', linestyle='--', label='–°—Ä–µ–∑ 10 –ì—Ü')
ax2.legend()
ax2.grid(True)

plt.tight_layout()
plt.show()"""

# ===== 5. –ü–†–û–ï–ö–¢–ò–†–û–í–ê–ù–ò–ï FIR (Window Method) =====
code_fir = """# –ü—Ä–æ–µ–∫—Ç–∏—Ä—É–µ–º FIR —Ñ–∏–ª—å—Ç—Ä –º–µ—Ç–æ–¥–æ–º –æ–∫–æ–Ω
# –¢–æ—Ç –∂–µ Low-Pass 10 –ì—Ü, –Ω–æ FIR

numtaps = 101  # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ—á–µ—Ç–Ω—ã–º)
b_fir = signal.firwin(numtaps, cutoff, fs=fs)

# –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è (–ø—Ä–æ—Å—Ç–∞—è —Å–≤—ë—Ä—Ç–∫–∞)
y_fir = signal.lfilter(b_fir, 1.0, x)

# –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∑–∞–¥–µ—Ä–∂–µ–∫
plt.figure(figsize=(12, 4))
plt.plot(t[:100], x[:100], 'gray', alpha=0.3, label='–í—Ö–æ–¥')
plt.plot(t[:100], y[:100], 'b', label='IIR (filtfilt - –Ω–µ—Ç –∑–∞–¥–µ—Ä–∂–∫–∏)')
plt.plot(t[:100], y_fir[:100], 'g--', label='FIR (lfilter - –µ—Å—Ç—å –∑–∞–¥–µ—Ä–∂–∫–∞!)')
plt.title('–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∑–∞–¥–µ—Ä–∂–µ–∫ —Ñ–∏–ª—å—Ç—Ä–æ–≤')
plt.legend()
plt.grid(True)
plt.show()

print("–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ: FIR —Ñ–∏–ª—å—Ç—Ä —Å–¥–≤–∏–≥–∞–µ—Ç —Å–∏–≥–Ω–∞–ª –≤–ø—Ä–∞–≤–æ (–≤–Ω–æ—Å–∏—Ç –∑–∞–¥–µ—Ä–∂–∫—É).")"""

# ===== 6. –ó–ê–î–ê–ù–ò–ï =====
md3 = r"""## üõ† –ó–ê–î–ê–ù–ò–ï: –†–µ–∂–µ–∫—Ç–æ—Ä–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä (Notch Filter)

**–°–∏—Ç—É–∞—Ü–∏—è:** –í—ã –∑–∞–ø–∏—Å–∞–ª–∏ –∑–≤—É–∫, –Ω–æ –≤ –Ω–µ–≥–æ –ø–æ–ø–∞–ª –≥—É–ª –æ—Ç —ç–ª–µ–∫—Ç—Ä–æ—Å–µ—Ç–∏ **50 –ì—Ü**.
**–ó–∞–¥–∞—á–∞:** –í—ã—Ä–µ–∑–∞—Ç—å –¢–û–õ–¨–ö–û 50 –ì—Ü, —Å–æ—Ö—Ä–∞–Ω–∏–≤ –æ—Å—Ç–∞–ª—å–Ω–æ–µ.

1. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ —Å–∏–≥–Ω–∞–ª: $x(t) = \sin(2\pi \cdot 10 \cdot t) + 0.6 \sin(2\pi \cdot 50 \cdot t)$
2. –°–ø—Ä–æ–µ–∫—Ç–∏—Ä—É–π—Ç–µ **Band-Stop (Notch)** —Ñ–∏–ª—å—Ç—Ä –ë–∞—Ç—Ç–µ—Ä–≤–æ—Ä—Ç–∞.
   - –ü–æ–ª–æ—Å–∞ –ø–æ–¥–∞–≤–ª–µ–Ω–∏—è: 48‚Äì52 –ì—Ü.
3. –û—Ç—Ñ–∏–ª—å—Ç—Ä—É–π—Ç–µ —Å–∏–≥–Ω–∞–ª.
4. –ü–æ—Å—Ç—Ä–æ–π—Ç–µ —Å–ø–µ–∫—Ç—Ä—ã –î–û –∏ –ü–û–°–õ–ï —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏."""

# ===== 7. –†–ï–®–ï–ù–ò–ï =====
code_task = """# 1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è
fs = 1000
t = np.arange(0, 1, 1/fs)
x_bad = np.sin(2*np.pi*10*t) + 0.6*np.sin(2*np.pi*50*t)

# 2. –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Notch —Ñ–∏–ª—å—Ç—Ä–∞ (Band-Stop)
# iirnotch - —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —É–∑–∫–∏—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
f0 = 50.0  # –ß–∞—Å—Ç–æ—Ç–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
Q = 30.0   # –ö–∞—á–µ—Å—Ç–≤–æ (—á–µ–º –±–æ–ª—å—à–µ, —Ç–µ–º —É–∂–µ –≤—ã—Ä–µ–∑)
b_notch, a_notch = signal.iirnotch(f0, Q, fs)

# 3. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è
y_clean = signal.filtfilt(b_notch, a_notch, x_bad)

# 4. –°–ø–µ–∫—Ç—Ä–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑
def plot_spectrum(sig, name, ax, color):
    X = np.fft.fft(sig)
    freqs = np.fft.fftfreq(len(sig), 1/fs)
    ax.plot(freqs[:len(sig)//2], np.abs(X)[:len(sig)//2], color=color)
    ax.set_title(name)
    ax.grid(True)
    ax.set_xlim([0, 100])

fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(12, 5))
plot_spectrum(x_bad, '–°–ø–µ–∫—Ç—Ä –î–û (–≤–∏–¥–µ–Ω –ø–∏–∫ 50 –ì—Ü)', ax1, 'r')
plot_spectrum(y_clean, '–°–ø–µ–∫—Ç—Ä –ü–û–°–õ–ï (–ø–∏–∫ 50 –ì—Ü —É–¥–∞–ª–µ–Ω)', ax2, 'g')
plt.show()"""

# ===== –°–ë–û–†–ö–ê =====
nb['cells'] = [
    nbf.v4.new_markdown_cell(md1),
    nbf.v4.new_code_cell(code_imports),
    nbf.v4.new_markdown_cell(md2),
    nbf.v4.new_code_cell(code_iir),
    nbf.v4.new_code_cell(code_fir),
    nbf.v4.new_markdown_cell(md3),
    nbf.v4.new_code_cell(code_task)
]

os.makedirs('notebooks/Lab4_Filters', exist_ok=True)
with open('notebooks/Lab4_Filters/Lab4_Filters.ipynb', 'w', encoding='utf-8') as f:
    nbf.write(nb, f)

print("‚úÖ Lab4_Filters.ipynb —Å–æ–∑–¥–∞–Ω!")
